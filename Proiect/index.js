const jsonArray = [
    {
        photo: "./images/Apple iPhone XS 256GB Space Grey.jpg",
        rating: 4.6,
        review: 679,
        name: "Apple iPhone XS 256GB Space Grey",
        memory: "32",
        price: 999,
    },
    {
        photo: "./images/Apple iPhone XS Max 256GB Silver.jpg",
        rating: 3.8,
        review: 279,
        name: "Apple iPhone XS Max 256GB Silver",
        memory: "64",
        price: 1009,
    },
    {
        photo: "./images/Apple iPhone 8 Plus 64GB 4G Silver.jpg",
        rating: 3.4,
        review: 379,
        name: "Apple iPhone 8 Plus 64GB 4G Silver",
        memory: "128",
        price: 799,
    },
    {
        photo: "./images/Apple iPhone XR Dual Sim 64GB Red.jpg",
        rating: 3,
        review: 379,
        name: "Apple iPhone XR Dual Sim 64GB Red",
        memory: "256",
        price: 899,
    },
    {
        photo: "./images/Apple iPhone X 64GB 4G Space Grey.jpg",
        rating: 4,
        review: 479,
        name: "Apple iPhone X 64GB 4G Space Grey",
        memory: "64",
        price: 999,
    },
    {
        photo: "./images/Apple iPhone 11 64GB Yellow.jpg",
        rating: 4.5,
        review: 579,
        name: "Apple iPhone 11 64GB Yellow",
        memory: "128",
        price: 1040,
    },
    {
        photo: "./images/Apple iPhone 11 Pro 64GB Gold.jpg",
        rating: 4.9,
        review: 679,
        name: "Apple iPhone 11 Pro 64GB Gold",
        memory: "32",
        price: 1299,
    },
    {
        photo: "./images/Apple iPhone 11 128GB Purple.jpg",
        rating: 2.6,
        review: 779,
        name: "Apple iPhone 11 128GB Purple",
        memory: "32",
        price: 699,
    },
    {
        photo: "./images/Apple iPhone SE 2 64GB 4G Black.jpg",
        rating: 3.8,
        review: 879,
        name: "Apple iPhone SE 2 64GB 4G Black",
        memory: "128",
        price: 899,
    },
    {
        photo: "./images/Apple iPhone 11 Pro 128GB Space Grey.jpg",
        rating: 2,
        review: 979,
        name: "Apple iPhone 11 Pro 128GB Space Grey",
        memory: "64",
        price: 699,

    },
    {
        photo: "./images/Huawei Y7 Dual SIM 32GB 4G Coral Red.jpg",
        rating: 2.3,
        review: 1079,
        name: "Huawei Y7 Dual SIM 32GB 4G Coral Red",
        memory: "32",
        price: 599,
    },
    {
        photo: "./images/Huawei P20 Pro Dual SIM 64GB 6GB RAM Twilight.jpg",
        rating: 1.5,
        review: 1179,
        name: "Huawei P20 Pro Dual SIM 64GB 6GB RAM Twilight",
        memory: "32",
        price: 499,
    },
    {
        photo: "./images/Huawei P40 Pro Dual SIM 256GB 8GB RAM Silver Frost.jpg",
        rating: 2.6,
        review: 779,
        name: "Huawei P40 Pro Dual SIM 256GB 8GB RAM Silver Frost",
        memory: "32",
        price: 699,
    },
    {
        photo: "./images/Huawei Nova 5T Dual SIM 128GB 6GB RAM Black.jpg",
        rating: 3.8,
        review: 879,
        name: "Huawei Nova 5T Dual SIM 128GB 6GB RAM Black",
        memory: "128",
        price: 899,
    },
    {
        photo: "./images/Huawei Nova 5T Dual SIM 32GB 6GB RAM Midsummer Purple.jpg",
        rating: 2,
        review: 979,
        name: "Huawei Nova 5T Dual SIM 32GB 6GB RAM Midsummer Purple",
        memory: "64",
        price: 699,

    },
    {
        photo: "./images/Huawei Y6P Dual SIM 32GB 4G Midnight Black.jpg",
        rating: 2.3,
        review: 1079,
        name: "Huawei Y6P Dual SIM 32GB 4G Midnight Black",
        memory: "32",
        price: 599,
    },
    {
        photo: "./images/Huawei P30 Pro Dual SIM 256GB 8GB Aurora Blue.jpg",
        rating: 1.5,
        review: 1179,
        name: "Huawei P30 Pro Dual SIM 256GB 8GB Aurora Blue",
        memory: "32",
        price: 499,
    },
    {
        photo: "./images/Huawei P30 Lite Dual SIM 128GB 4G Pearl White.jpg",
        rating: 2.6,
        review: 779,
        name: "Huawei P30 Lite Dual SIM 128GB 4G Pearl White",
        memory: "32",
        price: 699,
    },
    {
        photo: "./images/Huawei Mate XS Dual SIM 256GB 8GB RAM Interstellar Blue.jpg",
        rating: 3.8,
        review: 879,
        name: "Huawei Mate XS Dual SIM 256GB 8GB RAM Interstellar Blue",
        memory: "128",
        price: 899,
    },
    {
        photo: "./images/Huawei P40 Lite Dual SIM 128GB 6GB RAM Sakura Pink.jpg",
        rating: 2,
        review: 979,
        name: "Huawei P40 Lite Dual SIM 128GB 6GB RAM Sakura Pink",
        memory: "64",
        price: 699,

    },
    {
        photo: "./images/Samsung Galaxy A30s Dual SIM 64GB 4G White.jpg",
        rating: 2.3,
        review: 1079,
        name: "Samsung Galaxy A30s Dual SIM 64GB 4G White",
        memory: "32",
        price: 599,
    },
    {
        photo: "./images/Samsung Galaxy Note 8 64GB 6GB RAM Gold.jpg",
        rating: 1.5,
        review: 1179,
        name: "Samsung Galaxy Note 8 64GB 6GB RAM Gold",
        memory: "32",
        price: 499,
    },
    {
        photo: "./images/Samsung Galaxy S10e Dual SIM 128GB 6GB RAM Cardinal Red.jpg",
        rating: 2.6,
        review: 779,
        name: "Samsung Galaxy S10e Dual SIM 128GB 6GB RAM Cardinal Red",
        memory: "32",
        price: 699,
    },
    {
        photo: "./images/Samsung Galaxy Note 9 Dual SIM 256GB 8GB RAM Ocean Blue.jpg",
        rating: 3.8,
        review: 879,
        name: "Samsung Galaxy Note 9 Dual SIM 256GB 8GB RAM Ocean Blue",
        memory: "128",
        price: 899,
    },
    {
        photo: "./images/Samsung Galaxy S9 Dual SIM 64GB Purple.jpg",
        rating: 2,
        review: 979,
        name: "Samsung Galaxy S9 Dual SIM 64GB Purple",
        memory: "64",
        price: 699,

    },
    {
        photo: "./images/Samsung Galaxy S20 Plus Dual SIM 128GB 12GB RAM Aura Red.jpg",
        rating: 2.3,
        review: 1079,
        name: "Samsung Galaxy S20 Plus Dual SIM 128GB 12GB RAM Aura Red",
        memory: "32",
        price: 599,
    },
    {
        photo: "./images/Samsung Galaxy S20 Ultra Dual SIM 128GB 12GB RAM Cosmic Gray.jpg",
        rating: 1.5,
        review: 1179,
        name: "Samsung Galaxy S20 Ultra Dual SIM 128GB 12GB RAM Cosmic Gray",
        memory: "32",
        price: 499,
    },
    {
        photo: "./images/Samsung Galaxy Note 10 Plus 256GB 12GB RAM Aura Glow.jpg",
        rating: 2,
        review: 979,
        name: "Samsung Galaxy Note 10 Plus 256GB 12GB RAM Aura Glow",
        memory: "64",
        price: 699,

    },
    {
        photo: "./images/Samsung Galaxy S10 Dual SIM 256GB 8GB RAM Green.jpg",
        rating: 2.3,
        review: 1079,
        name: "Samsung Galaxy S10 Dual SIM 256GB 8GB RAM Green",
        memory: "32",
        price: 599,
    },
    {
        photo: "./images/Samsung Galaxy Z Flip Dual SIM 256GB 8GB RAM Mirror Purple.jpg",
        rating: 1.5,
        review: 1179,
        name: "Samsung Galaxy Z Flip Dual SIM 256GB 8GB RAM Mirror Purple",
        memory: "32",
        price: 499,
    }
]

const displayProducts = document.querySelector('#displayProducts');
const search = document.querySelector('#search')
const select = document.querySelector('#select')

//functii  de adaugare in DOM

const imgFn = (obj) => {
    const img = document.createElement('img');
    img.src = obj.photo;
    // img.style.width = '90%';
    return img;
}

const ratingFn = (obj) => {
    let div = document.createElement('div');
    let divStarsOuter = document.createElement('div');
    let divStarsInner = document.createElement('div');
    let span = document.createElement('span')

    div.appendChild(divStarsOuter)
    divStarsOuter.appendChild(divStarsInner)
    div.appendChild(span)
    span.innerText = `${obj.review} reviews `;
    div.classList.add("phoneRating");
    divStarsOuter.classList.add("starsOuter");
    divStarsInner.classList.add("starsInner");
    divStarsInner.style.width = `${obj.rating / 5 * 100}%`
    // console.log(obj.rating)
    return div;
}

const descriptionFn = (obj) => {
    let div = document.createElement('div');
    div.innerHTML = obj.name;
    div.classList.add("phoneDescription");
    return div;
}

const priceFn = (obj) => {
    let div = document.createElement('div');
    div.innerHTML = obj.price;
    div.classList.add("phonePrice");
    return div;
}

const buttonFn = () => {
    let buttonDiv = document.createElement('div');
    const button = document.createElement('button');
    button.innerText = "Add to Cart"
    buttonDiv.appendChild(button);
    buttonDiv.classList.add("buyPhone");
    button.addEventListener('click', (() => console.log('Added to cart')));
    return buttonDiv;
}

//REMOVE

const removeDataFromDom = () => [...document.querySelectorAll(".productDiv")].forEach(product => product.remove())// REMOVE DATA FROM DOM 

//SORTING

let populatingDomArray = [] // array care preia itemele din jsonArray
let rememberDomArray = [] //array pentru a reveni la datele initiale

const populateDataInDom = (array) => {

    populatingDomArray = []
    // let productDiv;

    for (let product of array) {

        let productDiv = document.createElement('div');
        imgDiv = document.createElement('div');
        infoDiv = document.createElement('div');
        productDiv.classList.add("productDiv");

        displayProducts.appendChild(productDiv);//adaugarea obiectelor in dom
        productDiv.appendChild(imgDiv)
        productDiv.appendChild(infoDiv)
        imgDiv.appendChild(imgFn(product));
        infoDiv.appendChild(ratingFn(product));
        infoDiv.appendChild(descriptionFn(product));
        infoDiv.appendChild(priceFn(product));
        infoDiv.appendChild(buttonFn());

        populatingDomArray.push(product)
    }

    return populatingDomArray;
};

// SEARCH

const searchFunction = searchText => {//de facut search dupa MEMORIE
    const regex = new RegExp(`^${searchText}`, 'gi')

    populatingDomArray = jsonArray.filter((item) => item.name.match(regex)) // item.name.toLowerCase().includes("ip")
    removeDataFromDom()
    if (populatingDomArray.length === 0) {
        alert("Your search didn't match our products")
        return populateDataInDom(jsonArray)
    }
    // modificat

    populateDataInDom(populatingDomArray)
    rememberDomArray = [...populatingDomArray]// adaugat
    return rememberDomArray
}

searchFunction("")

const filterPrice = (array) => array.sort((a, b) => a.price - b.price)
const filterPriceDescending = (array) => array.sort((a, b) => b.price - a.price)
const filterReview = (array) => array.sort((a, b) => b.review - a.review)

const sortBy = () => {
    // if(select.value=== "relevance"){ // DE REVAZUT
    //     removeDataFromDom()
    //     console.log(populatingDomArray)
    //     populateDataInDom(jsonArray)
    // }
    if (select.value === "priceAscending") {//switch
        removeDataFromDom()
        populateDataInDom(filterPrice(populatingDomArray))
    }

    else if (select.value === "priceDescending") {
        removeDataFromDom()
        populateDataInDom(filterPriceDescending(populatingDomArray))
    }

    else if (select.value === "reviewNumbers") {
        removeDataFromDom()
        populateDataInDom(filterReview(populatingDomArray))
    }
}

// console.log(populatingDomArray)

select.addEventListener('change', sortBy)
search.addEventListener("keyup", () => {// Search ENTER
    if (event.keyCode === 13) {
        searchFunction(search.value)
        search.value = ""
        return true;
    }
    return false;
})

//FILTER

let filtersObject = {
    memory: {
        "32": "32",
        "64": "64",
        "128": "128",
        "256": "256"
    },
    price: 1301,
    rating: 1
}

// FILTRARI CHECKBOXEs

const memoryCheckboxes = document.querySelectorAll("#memoryFilter > label > input[type=checkbox]")
const priceCheckboxes = document.querySelectorAll("#priceFilter > label > input[type=checkbox]")
const starsCheckboxes = document.getElementsByName('stars')
console.log(starsCheckboxes)

const checkRatingFn = () => {
    let checkboxArray = []

    starsCheckboxes.forEach(checkbox => {
        if (checkbox.checked) {
            checkboxArray.push(checkbox)

            filtersObject.rating = Number(checkbox.value)
            console.log(filtersObject)
        }
    })
    if (checkboxArray.length < 1) {
        filtersObject.rating = 1
    }
    checkedFunction()
}

const checkMemoryFn = () => { // 0 checked filterMemory
    let checkboxArray = []
    memoryCheckboxes.forEach(checkbox => {

        if (checkbox.checked) {
            // console.log(product["memory"])
            let matches = rememberDomArray.filter(product => {
                // console.log(product["memory"])
                return product["memory"] === checkbox.value
            })
            // console.log(matches)
            if (matches.length === 0) {//ALERT NO MATCHES FOR SEARCH
                alert("No matches for your search")
                return checkbox.checked = false// if no matches for search, uncheck the checkbox
            }
            checkboxArray.push(checkbox)
            filtersObject.memory[checkbox.value] = checkbox.value
            // console.log(filtersObject)
        }
        // console.log(checkboxArray)
        else filtersObject.memory[checkbox.value] = ""
        // console.log(checkboxArray.length)
    })
    if (checkboxArray.length < 1) {//when all memory checkboxes are unchecked, fill obj parameters for filter
        filtersObject.memory["32"] = "32";
        filtersObject.memory["64"] = "64";
        filtersObject.memory["128"] = "128";
        filtersObject.memory["256"] = "256";
    }
    checkedFunction()
}

const checkPriceFn = () => {
    let checkboxArray = []

    priceCheckboxes.forEach(checkbox => {
        if (checkbox.checked) {
            // let matches = populatingDomArray.filter(product => {

            //     if (product.price > 1000) return product.price <= checkbox.value // if phone > 999 then return phones >

            //     else return product.price <= checkbox.value &&
            //         product.price >= checkbox.value - 200
            // })
            // console.log(matches)
            // if (matches.length === 0) {//ALERT NO MATCHES FOR SEARCH
            //     alert("No matches for your search")
            //     return checkbox.checked = false// if no matches for search, uncheck the checkbox
            // }
            checkboxArray.push(checkbox)

            filtersObject.price = Number(checkbox.value)
            console.log(filtersObject)
        }
    })
    if (checkboxArray.length < 1) {
        filtersObject.price = 1301
    }
    checkedFunction()
}


const filtersFn = (obj) => {//filtrare obiecte DOM

    const x = rememberDomArray
        .filter(product => {
            // console.log(populatingDomArray)  

            return product.memory === obj.memory["32"]
                || product.memory === obj.memory["64"]
                || product.memory === obj.memory["128"]
                || product.memory === obj.memory["256"]
        })
        .filter(product => {
            if (obj.price > 1300) {
                return product.price < obj.price
            }
            if (obj.price === 1300) {
                return (obj.price - 300 < product.price && product.price < obj.price)
            }
            else { return obj.price - 200 < product.price && product.price < obj.price }
        })
        .filter(product => product.rating >= obj.rating)

    return x
}
// DE FACUT FN GENUL ASTA SI PENTRU MEMORY, STARS
const checkedFunction = (checkbox) => {

    removeDataFromDom()

    populateDataInDom(filtersFn(filtersObject))
    if (populatingDomArray.length < 1) {
        alert("adsadsadada")
    }
    return
}

const onlyOneStar = (checkbox) => {//const
    let checkboxes = document.getElementsByName('stars')
    checkboxes.forEach((item) => {
        if (item !== checkbox) item.checked = false
    })
}

const onlyOnePrice = (checkbox) => {
    let checkboxes = document.getElementsByName('price')
    checkboxes.forEach((item) => {
        if (item !== checkbox) {
            item.checked = false
        }
    })
}

let memoryFilterDiv = document.querySelector("#memoryFilter");
let priceFilterDiv = document.querySelector("#priceFilter");
let ratingFilterDiv = document.querySelector("#ratingFilter");
memoryFilterDiv.addEventListener('change', checkMemoryFn);
priceFilterDiv.addEventListener('change', checkPriceFn)
ratingFilterDiv.addEventListener('change', checkRatingFn)

const hideSidebar = () => {

    let hideSidebar = document.querySelector(".sideBar")
    let displayProducts = document.querySelector("#displayProducts")
    if (window.innerWidth > 1000) {
        console.log("hehehehee")
        //  return hideSidebar.classList.remove("revealSidebar") 
    }
    hideSidebar.classList.toggle("revealSidebar")
    displayProducts.classList.toggle("displayMargin")

}
// hideSidebar()
// hideSidebar()
window.addEventListener('resize', function () {
    let hideSidebar = document.querySelector(".sideBar")
    console.log(hideSidebar)
    let displayProducts = document.querySelector("#displayProducts")
    console.log(hideSidebar.classList.contains("revealSidebar"))
    if (window.innerWidth > 1000) {
        if (hideSidebar.classList.contains("revealSidebar")) {
            console.log("hehehehee")
            hideSidebar.classList.remove("revealSidebar")
            return displayProducts.classList.remove("displayMargin")
        }
    }
})

window.addEventListener("scroll", function (){
    console.log('dadsada')
    console.log(document.querySelector('#navDiv'))
    document.querySelector('#navDiv').classList.toggle('reduceTransparency')
    document.querySelector('#sortHeader').classList.toggle('reduceTransparency')
})
// console.log(document.getElementsByClassName(""))
const rotateClass = document.querySelectorAll(".rotateClass")
// console.log(rotateClass)
rotateClass.forEach(item => {
    item.addEventListener('click', () => {
        item.parentElement.parentElement.classList.toggle("minimize")

        return item.classList.toggle("rotateClass")
    })
})
// console.log("hasadsadsa")
//add eventlistener TO DISPLAYPRODUCTS
//MEHHHH
const toggleBtn = document.querySelector("#toggleFilters")
toggleBtn.addEventListener('click', hideSidebar)
